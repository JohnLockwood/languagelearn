{
    "Description": "AWS CloudFormation Sample Template: This template demonstrates the creation of a DynamoDB table.",
    "Parameters": {
        "AppSyncApiId": {
            "Description": "The id of the AppSync API associated with this project.",
            "Type": "String"
        },
        "AppSyncApiName": {
            "Default": "NONE",
            "Description": "The environment name. e.g. Dev, Test, or Production",
            "Type": "String"
        },
        "S3DeploymentBucket": {
            "Description": "The S3 bucket containing all deployment assets for the project.",
            "Type": "String"
        },
        "S3DeploymentRootKey": {
            "Description": "An S3 key relative to the S3DeploymentBucket that points to the root\nof the deployment directory.",
            "Type": "String"
        }
    },
    "Resources": {
        "conversationTable": {
            "Properties": {
                "AttributeDefinitions": [
                    {
                        "AttributeName": "id",
                        "AttributeType": "S"
                    }
                ],
                "BillingMode": "PAY_PER_REQUEST",
                "KeySchema": [
                    {
                        "AttributeName": "id",
                        "KeyType": "HASH"
                    }
                ],
                "TableName": "dev_conversation"
            },
            "Type": "AWS::DynamoDB::Table"
        },
        "messageTable": {
            "Properties": {
                "AttributeDefinitions": [
                    {
                        "AttributeName": "conversationId",
                        "AttributeType": "S"
                    },
                    {
                        "AttributeName": "createdAt",
                        "AttributeType": "S"
                    }
                ],
                "BillingMode": "PAY_PER_REQUEST",
                "KeySchema": [
                    {
                        "AttributeName": "conversationId",
                        "KeyType": "HASH"
                    },
                    {
                        "AttributeName": "createdAt",
                        "KeyType": "RANGE"
                    }
                ],
                "TableName": "dev_message"
            },
            "Type": "AWS::DynamoDB::Table"
        },
        "userConversationTable": {
            "Properties": {
                "AttributeDefinitions": [
                    {
                        "AttributeName": "userId",
                        "AttributeType": "S"
                    },
                    {
                        "AttributeName": "conversationId",
                        "AttributeType": "S"
                    }
                ],
                "BillingMode": "PAY_PER_REQUEST",
                "GlobalSecondaryIndexes": [
                    {
                        "IndexName": "conversationId-index",
                        "KeySchema": [
                            {
                                "AttributeName": "conversationId",
                                "KeyType": "HASH"
                            }
                        ],
                        "Projection": {
                            "ProjectionType": "ALL"
                        }
                    }
                ],
                "KeySchema": [
                    {
                        "AttributeName": "userId",
                        "KeyType": "HASH"
                    },
                    {
                        "AttributeName": "conversationId",
                        "KeyType": "RANGE"
                    }
                ],
                "TableName": "dev_user_conversation"
            },
            "Type": "AWS::DynamoDB::Table"
        },
        "userTable": {
            "Properties": {
                "AttributeDefinitions": [
                    {
                        "AttributeName": "id",
                        "AttributeType": "S"
                    }
                ],
                "BillingMode": "PAY_PER_REQUEST",
                "KeySchema": [
                    {
                        "AttributeName": "id",
                        "KeyType": "HASH"
                    }
                ],
                "TableName": "dev_user"
            },
            "Type": "AWS::DynamoDB::Table"
        }
    }
}